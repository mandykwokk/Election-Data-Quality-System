{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mandy\\\\IdeaProjects\\\\DataQuality-Frontend\\\\src\\\\components\\\\map\\\\MapScreen.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Map, TileLayer, LayersControl, ZoomControl, GeoJSON, Marker, Popup } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet-draw';\nimport Control from 'react-leaflet-control';\nimport * as Turf from '@turf/turf';\nimport { Layout, Checkbox, Card, Spin, message } from 'antd';\nimport BorderJsonRequester from 'requesters/BorderJsonRequester';\nimport HistoryRequester from 'requesters/HistoryRequester';\nimport ErrorRequester from 'requesters/ErrorRequester';\nimport LayerStyler from 'utils/LayerStyler';\nimport * as Constants from 'constants/constants';\nimport StateContext from 'contexts/StateContext';\nimport DistrictContext from 'contexts/DistrictContext';\nimport HistoryContext from 'contexts/HistoryContext';\nimport RerenderContext from 'contexts/RerenderContext';\nimport LeftPanel from './LeftPanel/LeftPanel';\nimport RightPanel from './RightPanel/RightPanel';\nimport CommentTab from './RightPanel/CommentTab';\nimport HeaderPanel from './HeaderPanel/HeaderPanel';\nimport moment from 'moment';\nimport PrecinctRequester from 'requesters/PrecinctRequester';\nconst borderJsonRequester = new BorderJsonRequester();\nconst historyRequester = new HistoryRequester();\nconst errorRequester = new ErrorRequester();\nconst layerStyler = new LayerStyler();\nconst precinctRequester = new PrecinctRequester();\nmessage.config({\n  top: 60,\n  duration: 3\n});\nconst NpMarker = new L.Icon({\n  iconUrl: 'images/NpMarker.png',\n  iconSize: [48, 48]\n});\nexport default function MapScreen() {\n  const [mapRef, setMapRef] = useState(null);\n  const [zoomLevel, setZoomLevel] = useState(4);\n  const [showDistricts, setShowDistricts] = useState(true);\n  const [showPrecincts, setShowPrecincts] = useState(true);\n  const [showNp, setShowNp] = useState(false);\n  const [showCommentTab, setShowCommentTab] = useState(false);\n  const [selectedState, setSelectedState] = useState(null);\n  const [selectedCd, setSelectedCd] = useState(null);\n  const [selectedPrecinct, setSelectedPrecinct] = useState(null);\n  const [selectedElection, setSelectedElection] = useState(Constants.ELECTIONS[0]);\n  const [selectedHistory, setSelectedHistory] = useState(null);\n  const [stateBorders, setStateBorders] = useState(null);\n  const stateLayerRefs = useRef([React.createRef(), React.createRef(), React.createRef()]);\n  const [cdBorders, setCdBorders] = useState(null);\n  const [precinctBorders, setPrecinctBorders] = useState(null);\n  const [precinctsRef, setPrecinctsRef] = useState(null);\n  const [npBorders, setNpBorders] = useState(null);\n  const [npMarkers] = useState([]);\n  const [ghostMarkers, setGhostMarkers] = useState([]);\n  const [history, setHistory] = useState([[], [], [], [], [], []]);\n  const [errors, setErrors] = useState([[], [], [], [], [], []]);\n  const [delayHandler, setDelayHandler] = useState(null);\n  const [addingNeighbor, setAddingNeighbor] = useState(false);\n  const [removingNeighbor, setRemovingNeighbor] = useState(false);\n  const [combiningPrecinct, setCombiningPrecinct] = useState(false);\n  const [rerender, setRerender] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [drawController, setDrawController] = useState(null);\n  useEffect(() => {\n    (async () => {\n      setStateBorders((await borderJsonRequester.getStateBorders()));\n      setCdBorders((await borderJsonRequester.getCdBorders()));\n      const npBorders = await borderJsonRequester.getNpBorders();\n      setNpBorders(npBorders);\n      npBorders.features.forEach(feature => {\n        const center = Turf.centroid(Turf.feature(feature.geometry));\n        center.geometry.coordinates = center.geometry.coordinates.reverse();\n        center.properties.name = feature.properties.UNIT_NAME;\n        npMarkers.push(center);\n      });\n    })();\n  }, [npMarkers]);\n\n  function calculateFeatureCenter(feature) {\n    return Turf.centroid(Turf.feature(feature.geometry));\n  }\n\n  function handleStateChangeDropdown(stateName) {\n    handleStateChange(stateBorders[Constants.STATES.indexOf(stateName)], null);\n  }\n\n  async function handleStateChange(state, layer) {\n    if (selectedState && state.name === selectedState.name) return;\n    if (!layer) mapRef.leafletElement.fitBounds(stateLayerRefs.current[Constants.STATES.indexOf(state.name)].current.leafletElement.getBounds());else mapRef.leafletElement.fitBounds(layer.getBounds());\n    setSelectedState(null);\n    setSelectedState(state);\n    setSelectedCd(null);\n    setSelectedPrecinct(null);\n    setPrecinctBorders(null);\n    setHistory([[], [], [], [], [], []]);\n    setErrors([[], [], [], [], [], []]);\n  }\n\n  function handlePrecinctChange(layer) {\n    setSelectedPrecinct(null);\n    setSelectedPrecinct(layer.feature);\n  }\n\n  function handlePrecinctLayerOnClick(e) {\n    if (addingNeighbor) {\n      if (precinctRequester.updateNeighbor(selectedPrecinct.id, e.layer.feature.id, true)) {\n        selectedPrecinct.neighbors.push(e.layer.feature.id);\n        e.layer.feature.neighbors.push(selectedPrecinct.id);\n        setAddingNeighbor(false);\n        handleAddHistory({\n          description: `Added ${e.layer.feature.id} to ${selectedPrecinct.id}'s neighbor`\n        }, selectedPrecinct);\n        handleAddHistory({\n          description: `Added ${selectedPrecinct.id} to ${e.layer.feature.id}'s neighbor`\n        }, e.layer.feature);\n        message.success('Successfully added neighbor.');\n      }\n    } else if (removingNeighbor) {\n      for (var i = 0; i < selectedPrecinct.neighbors.length; i++) {\n        if (selectedPrecinct.neighbors[i] === e.layer.feature.id) selectedPrecinct.neighbors.splice(i, 1);\n      }\n\n      for (var j = 0; j < e.layer.feature.neighbors.length; j++) {\n        if (e.layer.feature.neighbors[j] === selectedPrecinct.id) e.layer.feature.neighbors.splice(j, 1);\n      }\n\n      if (precinctRequester.updateNeighbor(selectedPrecinct.id, e.layer.feature.id, false)) {\n        setRemovingNeighbor(false);\n        handleAddHistory({\n          description: `Removed ${e.layer.feature.id} from ${selectedPrecinct.id}'s neighbor`\n        }, selectedPrecinct);\n        handleAddHistory({\n          description: `Removed ${selectedPrecinct.id} from ${e.layer.feature.id}'s neighbor`\n        }, e.layer.feature);\n        message.success('Successfully removed neighbor.');\n      }\n    } else if (combiningPrecinct) {\n      if (!selectedPrecinct.properties.neighbors.includes(e.layer.feature.id)) {\n        message.error('Please select a neighbor precinct to combine.');\n        return;\n      }\n\n      const clickedPrecinct = e.layer.feature;\n      const newFeature = Turf.union(Turf.feature(selectedPrecinct.geometry), Turf.feature(clickedPrecinct.geometry));\n      newFeature.properties = {\n        NAME10: selectedPrecinct.id,\n        CONGRESSIO: selectedPrecinct.properties.CONGRESSIO,\n        neighbors: selectedPrecinct.properties.neighbors.concat(clickedPrecinct.properties.neighbors).filter(item => {\n          return item !== selectedPrecinct.id && item !== clickedPrecinct.id;\n        }),\n        comments: selectedPrecinct.properties.comments.concat(clickedPrecinct.properties.comments),\n        demographic: selectedPrecinct.properties.demographic.map((item, index) => {\n          return item + clickedPrecinct.properties.demographic[index];\n        }),\n        election: selectedPrecinct.properties.election.map((item, index) => {\n          return item + clickedPrecinct.properties.election[index];\n        }),\n        isGhost: false\n      };\n      precinctBorders.features = precinctBorders.features.filter(item => {\n        return item.id !== selectedPrecinct.id && item.id !== clickedPrecinct.id;\n      });\n      precinctBorders.features.push(newFeature);\n      precinctsRef.leafletElement.clearLayers();\n      precinctsRef.leafletElement.addData(precinctBorders);\n      setSelectedPrecinct(null);\n      setSelectedPrecinct(newFeature);\n      handleAddHistory(`Combined precincts ${selectedPrecinct.id} with ${clickedPrecinct.id}`);\n      message.success('Successfully combined precincts.');\n      setCombiningPrecinct(false);\n    } else if (selectedPrecinct && selectedPrecinct.id === e.layer.feature.id) {\n      setSelectedPrecinct(null);\n    } else {\n      message.success(\"went to else\");\n      handlePrecinctChange(e.layer);\n    }\n  }\n\n  function handlePrecinctLayerMouseOver(e) {\n    if (addingNeighbor || combiningPrecinct || drawController) {\n      return;\n    }\n\n    setDelayHandler(setTimeout(() => {\n      handlePrecinctChange(e.layer);\n    }, 500));\n  }\n\n  function handleZoomChange() {\n    setZoomLevel(mapRef.viewport.zoom);\n  }\n\n  function handleShowPrecincts(e) {\n    setShowPrecincts(e.target.checked);\n  }\n\n  function handleShowDistricts(e) {\n    setShowDistricts(e.target.checked);\n  }\n\n  function handleShowNp(e) {\n    setShowNp(e.target.checked);\n  }\n\n  function handleCombinePrecinct() {\n    setCombiningPrecinct(true);\n    message.info('Please click on a neighbor precinct to combine.');\n  }\n\n  function handleConfirmGhostPrecinct() {\n    selectedPrecinct.name = selectedPrecinct.name.substring(selectedPrecinct.name.indexOf(\" \") + 1);\n\n    if (precinctRequester.updateGhostPrecinct(selectedPrecinct.id)) {\n      setRerender(!rerender);\n      handleAddHistory({\n        description: `Confirmed precinct ${selectedPrecinct.id} is a Ghost Precinct.`\n      }, selectedPrecinct);\n      message.success('Action Completed');\n    } else {\n      message.error('Action Failed');\n    }\n  }\n\n  function handleEditPrecinctLayer() {\n    const featureGroup = L.featureGroup([new L.polygon(selectedPrecinct.geometry.coordinates[0].map(positions => [positions[1], positions[0]]))]);\n    mapRef.leafletElement.addLayer(featureGroup);\n    const drawController = new L.EditToolbar.Edit(mapRef.leafletElement, {\n      featureGroup: featureGroup\n    });\n    setDrawController(drawController);\n    mapRef.leafletElement.removeEventListener('draw:edited');\n    mapRef.leafletElement.addEventListener('draw:edited', function (e) {\n      const layersKey = Object.keys(e.layers._layers);\n      if (layersKey.length === 0) return;\n      const layer = e.layers._layers[layersKey[0]];\n      const geoJson = {\n        type: \"Polygon\",\n        coordinates: [layer._latlngs[0].map(item => [item.lng, item.lat])]\n      };\n      const kinks = Turf.kinks(geoJson);\n\n      if (kinks.features.length) {\n        message.error(\"Self-Intersection Detected, Please Do It Again!\");\n        return;\n      }\n\n      precinctRequester.updateBoundary(selectedPrecinct.id, JSON.stringify(geoJson));\n      selectedPrecinct.geometry = geoJson;\n      precinctsRef.leafletElement.clearLayers();\n      precinctsRef.leafletElement.addData(precinctBorders);\n      message.success(`Successfully edited ${selectedPrecinct.name}'s boundary.`);\n      handleAddHistory({\n        description: `Edited ${selectedPrecinct.name}'s boundary.`\n      }, selectedPrecinct);\n    });\n    mapRef.leafletElement.removeEventListener('draw:editstop');\n    mapRef.leafletElement.addEventListener('draw:editstop', function (e) {\n      mapRef.leafletElement.removeLayer(featureGroup);\n    });\n    drawController.enable();\n  }\n\n  function handleDrawSave() {\n    if (drawController instanceof L.Draw.Polygon) drawController.completeShape();else drawController.save();\n    handleClickedCancel();\n  }\n\n  function handleClickedCancel() {\n    if (addingNeighbor) {\n      setAddingNeighbor(false);\n      message.info('Cancelled adding neighbor.');\n    } else if (combiningPrecinct) {\n      setCombiningPrecinct(false);\n      message.info('Cancelled combining precincts.');\n    } else {\n      drawController.disable();\n      setDrawController(null);\n    }\n  }\n\n  function handleDrawUndo() {\n    if (drawController instanceof L.Draw.Polygon) drawController.deleteLastVertex();else drawController.revertLayers();\n  }\n\n  function handleAddNeighbor() {\n    setAddingNeighbor(true);\n    message.info('Please click on another precinct to add.');\n  }\n\n  function handleRemoveNeighbor() {\n    setRemovingNeighbor(true);\n    message.info('Please click on another precinct to remove.');\n  }\n\n  async function handleAddHistory(newHistory, precinct, layer = null) {\n    newHistory.timestamp = moment();\n\n    if (await historyRequester.postHistory(newHistory, precinct.id)) {\n      if (newHistory.category) history[Constants.ERROR_ENUM.indexOf(newHistory.category)].push([newHistory, layer]);\n      newHistory.precinct = precinct;\n      precinct.histories.push(newHistory);\n    } else {\n      message.error('Failed to post history.');\n    } // setHistory([newLog, ...history]);\n\n  }\n\n  function handleZoomInPrecinct(feature, layer) {\n    setSelectedPrecinct(feature);\n    mapRef.leafletElement.fitBounds(layer.getBounds());\n  }\n\n  function handleResolvedError(error, index, layer) {\n    const res = errorRequester.ResolveError(error.id);\n\n    if (res) {\n      errors[index] = errors[index].filter(item => {\n        return error.id !== item[0].id;\n      });\n      setRerender(!rerender);\n      const description = \"Resolved error \" + Constants.ERROR_HEADER[Constants.ERROR_ENUM.indexOf(error.category)] + \". Error description: \" + error.description;\n      handleAddHistory({\n        description,\n        category: error.category\n      }, error.precinct, layer);\n      message.success('Successfully resolved the error.');\n    } else {\n      message.error('Failed to resolve.');\n    }\n  }\n\n  function handleOpenCommentTab(history) {\n    setShowCommentTab(true);\n    setSelectedHistory(history);\n  }\n\n  function handleCloseCommentTab() {\n    setShowCommentTab(false);\n    setSelectedHistory(null);\n  }\n\n  function handleAddComment(comment, timestamp) {}\n\n  function onEachStateFeature(state, layer) {\n    state.elections = JSON.parse(JSON.stringify(Constants.FAKE_ELECTION));\n    layer.on({\n      click: async () => {\n        handleStateChange(state, layer);\n      },\n      mouseover: () => {\n        layer.setStyle({\n          weight: 3\n        });\n      },\n      mouseout: () => {\n        layer.setStyle({\n          weight: 1\n        });\n      }\n    });\n  }\n\n  function onEachCdFeature(district, layer) {\n    district.elections = JSON.parse(JSON.stringify(Constants.FAKE_ELECTION));\n    layer.on({\n      click: async () => {\n        setLoading(true);\n        setSelectedCd(null);\n        setPrecinctBorders(null);\n        setSelectedPrecinct(null);\n        setHistory([[], [], [], [], [], []]);\n        setErrors([[], [], [], [], [], []]);\n        await borderJsonRequester.getPrecinctBorder(district.name).then(res => {\n          setPrecinctBorders(res);\n        });\n        setSelectedCd(district);\n        setLoading(false);\n      },\n      mouseover: () => {\n        layer.setStyle({\n          weight: 3\n        });\n      },\n      mouseout: () => {\n        layer.setStyle({\n          weight: 1\n        });\n      }\n    });\n  }\n\n  function onEachPrecinctFeature(precinct, layer) {\n    precinct.elections = JSON.parse(JSON.stringify(Constants.FAKE_ELECTION));\n    precinct.errors.forEach((item, index) => {\n      item.precinct = precinct;\n      if (item.category) errors[Constants.ERROR_ENUM.indexOf(item.category)].push([item, layer]);\n    });\n    precinct.histories.forEach((item, index) => {\n      item.precinct = precinct;\n      if (item.category) history[Constants.ERROR_ENUM.indexOf(item.category)].push([item, layer]);\n    });\n  }\n\n  return React.createElement(Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 439\n    },\n    __self: this\n  }, React.createElement(StateContext.Provider, {\n    value: selectedState,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440\n    },\n    __self: this\n  }, React.createElement(DistrictContext.Provider, {\n    value: selectedCd,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 441\n    },\n    __self: this\n  }, React.createElement(HistoryContext.Provider, {\n    value: [history, handleAddHistory],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 442\n    },\n    __self: this\n  }, React.createElement(RerenderContext.Provider, {\n    value: [rerender, setRerender],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443\n    },\n    __self: this\n  }, React.createElement(LeftPanel, {\n    errors: errors,\n    history: history,\n    handleZoomInPrecinct: handleZoomInPrecinct,\n    handleResolvedError: handleResolvedError,\n    handleAddComment: handleAddComment,\n    handleOpenCommentTab: handleOpenCommentTab,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444\n    },\n    __self: this\n  }), React.createElement(Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 452\n    },\n    __self: this\n  }, React.createElement(Layout.Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 453\n    },\n    __self: this\n  }, React.createElement(HeaderPanel, {\n    selectedPrecinct: selectedPrecinct,\n    zoomLevel: zoomLevel,\n    handleStateChangeDropdown: handleStateChangeDropdown,\n    combiningPrecinct: combiningPrecinct,\n    handleCombinePrecinct: handleCombinePrecinct,\n    addingNeighbor: addingNeighbor,\n    removingNeighbor: removingNeighbor,\n    handleAddNeighbor: handleAddNeighbor,\n    handleRemoveNeighbor: handleRemoveNeighbor,\n    handleConfirmGhostPrecinct: handleConfirmGhostPrecinct,\n    handleEditPrecinctLayer: handleEditPrecinctLayer,\n    drawController: drawController,\n    handleClickedCancel: handleClickedCancel,\n    handleDrawSave: handleDrawSave,\n    handleDrawUndo: handleDrawUndo,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 454\n    },\n    __self: this\n  })), React.createElement(Spin, {\n    spinning: loading,\n    size: \"large\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 472\n    },\n    __self: this\n  }, React.createElement(Layout.Content, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 473\n    },\n    __self: this\n  }, React.createElement(Map, {\n    ref: ref => {\n      setMapRef(ref);\n    },\n    center: Constants.MAP_CENTER,\n    zoom: 4,\n    zoomControl: false,\n    animate: true,\n    onZoomEnd: handleZoomChange,\n    preferCanvas: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 474\n    },\n    __self: this\n  }, React.createElement(TileLayer, {\n    attribution: \"\\xA9 <a href=\\\"http://osm.org/copyright\\\">OpenStreetMap</a> contributors\",\n    url: \"https://api.tiles.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaGFubGl1IiwiYSI6ImNrNnk3YTZpMzBlcjczZW15cmU1Mm5hMWkifQ.dW0oDKWDng4w-osIkRvLsQ\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 483\n    },\n    __self: this\n  }), React.createElement(ZoomControl, {\n    position: \"bottomright\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 487\n    },\n    __self: this\n  }), React.createElement(Control, {\n    position: \"bottomleft\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 488\n    },\n    __self: this\n  }, React.createElement(Card, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 489\n    },\n    __self: this\n  }, React.createElement(Checkbox, {\n    defaultChecked: true,\n    onChange: handleShowDistricts,\n    disabled: zoomLevel < Constants.DP_ZOOM_LEVEL || !selectedState,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 490\n    },\n    __self: this\n  }, \"Show Districts\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 497\n    },\n    __self: this\n  }), React.createElement(Checkbox, {\n    defaultChecked: true,\n    onChange: handleShowPrecincts,\n    disabled: zoomLevel < Constants.DP_ZOOM_LEVEL || !selectedCd,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 498\n    },\n    __self: this\n  }, \"Show Precincts\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 505\n    },\n    __self: this\n  }), React.createElement(Checkbox, {\n    onChange: handleShowNp,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 506\n    },\n    __self: this\n  }, \"Show National Parks \\xA0\", React.createElement(\"img\", {\n    src: \"images/NpIcon.png\",\n    alt: \"National Park Icon\",\n    className: \"icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 508\n    },\n    __self: this\n  })))), stateBorders && stateBorders.map((stateBorder, index) => {\n    if (selectedState && stateBorder.name === selectedState.name && zoomLevel >= Constants.DP_ZOOM_LEVEL && (showDistricts || showPrecincts && selectedCd)) {\n      return React.createElement(React.Fragment, {\n        key: \"F\" + index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 521\n        },\n        __self: this\n      }, showDistricts && React.createElement(GeoJSON, {\n        key: \"CD\" + index,\n        data: cdBorders[Constants.STATES.indexOf(selectedState.name)],\n        style: layerStyler.geoJSONCdStyle,\n        onEachFeature: onEachCdFeature,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 522\n        },\n        __self: this\n      }), showPrecincts && precinctBorders && React.createElement(GeoJSON, {\n        key: \"P\" + index,\n        ref: ref => {\n          setPrecinctsRef(ref);\n        },\n        data: precinctBorders,\n        style: feature => layerStyler.geoJSONPrecinctStyle(feature, selectedPrecinct),\n        onEachFeature: onEachPrecinctFeature,\n        onClick: handlePrecinctLayerOnClick,\n        onMouseOver: handlePrecinctLayerMouseOver,\n        onMouseOut: () => clearTimeout(delayHandler),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 529\n        },\n        __self: this\n      }));\n    } else {\n      return React.createElement(GeoJSON, {\n        key: \"S\" + index,\n        ref: stateLayerRefs.current[index],\n        data: stateBorder,\n        style: layerStyler.geoJSONStateStyle,\n        onEachFeature: onEachStateFeature,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 545\n        },\n        __self: this\n      });\n    }\n  }), npBorders && showNp && React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 557\n    },\n    __self: this\n  }, React.createElement(GeoJSON, {\n    data: npBorders,\n    style: feature => layerStyler.geoJSONNpStyle(feature),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 558\n    },\n    __self: this\n  }), \")}\", npMarkers.map((feature, index) => React.createElement(Marker, {\n    key: `marker-${index}`,\n    position: feature.geometry.coordinates,\n    icon: NpMarker,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 564\n    },\n    __self: this\n  }, React.createElement(Popup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 569\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 570\n    },\n    __self: this\n  }, \"Name: \", feature.properties.name))))))))), React.createElement(RightPanel, {\n    selectedPrecinct: selectedPrecinct,\n    selectedCd: selectedCd,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 580\n    },\n    __self: this\n  }), React.createElement(CommentTab, {\n    showCommentTab: showCommentTab,\n    handleCloseCommentTab: handleCloseCommentTab,\n    selectedHistory: selectedHistory,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 581\n    },\n    __self: this\n  }))))));\n}","map":{"version":3,"sources":["C:/Users/mandy/IdeaProjects/DataQuality-Frontend/src/components/map/MapScreen.js"],"names":["React","useState","useEffect","useRef","Map","TileLayer","LayersControl","ZoomControl","GeoJSON","Marker","Popup","L","Control","Turf","Layout","Checkbox","Card","Spin","message","BorderJsonRequester","HistoryRequester","ErrorRequester","LayerStyler","Constants","StateContext","DistrictContext","HistoryContext","RerenderContext","LeftPanel","RightPanel","CommentTab","HeaderPanel","moment","PrecinctRequester","borderJsonRequester","historyRequester","errorRequester","layerStyler","precinctRequester","config","top","duration","NpMarker","Icon","iconUrl","iconSize","MapScreen","mapRef","setMapRef","zoomLevel","setZoomLevel","showDistricts","setShowDistricts","showPrecincts","setShowPrecincts","showNp","setShowNp","showCommentTab","setShowCommentTab","selectedState","setSelectedState","selectedCd","setSelectedCd","selectedPrecinct","setSelectedPrecinct","selectedElection","setSelectedElection","ELECTIONS","selectedHistory","setSelectedHistory","stateBorders","setStateBorders","stateLayerRefs","createRef","cdBorders","setCdBorders","precinctBorders","setPrecinctBorders","precinctsRef","setPrecinctsRef","npBorders","setNpBorders","npMarkers","ghostMarkers","setGhostMarkers","history","setHistory","errors","setErrors","delayHandler","setDelayHandler","addingNeighbor","setAddingNeighbor","removingNeighbor","setRemovingNeighbor","combiningPrecinct","setCombiningPrecinct","rerender","setRerender","loading","setLoading","drawController","setDrawController","getStateBorders","getCdBorders","getNpBorders","features","forEach","feature","center","centroid","geometry","coordinates","reverse","properties","name","UNIT_NAME","push","calculateFeatureCenter","handleStateChangeDropdown","stateName","handleStateChange","STATES","indexOf","state","layer","leafletElement","fitBounds","current","getBounds","handlePrecinctChange","handlePrecinctLayerOnClick","e","updateNeighbor","id","neighbors","handleAddHistory","description","success","i","length","splice","j","includes","error","clickedPrecinct","newFeature","union","NAME10","CONGRESSIO","concat","filter","item","comments","demographic","map","index","election","isGhost","clearLayers","addData","handlePrecinctLayerMouseOver","setTimeout","handleZoomChange","viewport","zoom","handleShowPrecincts","target","checked","handleShowDistricts","handleShowNp","handleCombinePrecinct","info","handleConfirmGhostPrecinct","substring","updateGhostPrecinct","handleEditPrecinctLayer","featureGroup","polygon","positions","addLayer","EditToolbar","Edit","removeEventListener","addEventListener","layersKey","Object","keys","layers","_layers","geoJson","type","_latlngs","lng","lat","kinks","updateBoundary","JSON","stringify","removeLayer","enable","handleDrawSave","Draw","Polygon","completeShape","save","handleClickedCancel","disable","handleDrawUndo","deleteLastVertex","revertLayers","handleAddNeighbor","handleRemoveNeighbor","newHistory","precinct","timestamp","postHistory","category","ERROR_ENUM","histories","handleZoomInPrecinct","handleResolvedError","res","ResolveError","ERROR_HEADER","handleOpenCommentTab","handleCloseCommentTab","handleAddComment","comment","onEachStateFeature","elections","parse","FAKE_ELECTION","on","click","mouseover","setStyle","weight","mouseout","onEachCdFeature","district","getPrecinctBorder","then","onEachPrecinctFeature","ref","MAP_CENTER","DP_ZOOM_LEVEL","stateBorder","geoJSONCdStyle","geoJSONPrecinctStyle","clearTimeout","geoJSONStateStyle","geoJSONNpStyle"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { Map, TileLayer, LayersControl, ZoomControl, GeoJSON, Marker, Popup } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet-draw';\r\nimport Control from 'react-leaflet-control';\r\nimport * as Turf from '@turf/turf';\r\nimport { Layout, Checkbox, Card, Spin, message } from 'antd';\r\nimport BorderJsonRequester from 'requesters/BorderJsonRequester';\r\nimport HistoryRequester from 'requesters/HistoryRequester';\r\nimport ErrorRequester from 'requesters/ErrorRequester';\r\nimport LayerStyler from 'utils/LayerStyler';\r\nimport * as Constants from 'constants/constants';\r\nimport StateContext from 'contexts/StateContext';\r\nimport DistrictContext from 'contexts/DistrictContext';\r\nimport HistoryContext from 'contexts/HistoryContext';\r\nimport RerenderContext from 'contexts/RerenderContext';\r\nimport LeftPanel from './LeftPanel/LeftPanel';\r\nimport RightPanel from './RightPanel/RightPanel';\r\nimport CommentTab from './RightPanel/CommentTab';\r\nimport HeaderPanel from './HeaderPanel/HeaderPanel'\r\nimport moment from 'moment';\r\nimport PrecinctRequester from 'requesters/PrecinctRequester';\r\n\r\nconst borderJsonRequester = new BorderJsonRequester();\r\nconst historyRequester = new HistoryRequester();\r\nconst errorRequester = new ErrorRequester();\r\nconst layerStyler = new LayerStyler();\r\nconst precinctRequester = new PrecinctRequester();\r\nmessage.config({\r\n    top: 60,\r\n    duration: 3\r\n});\r\n\r\nconst NpMarker = new L.Icon({\r\n    iconUrl: 'images/NpMarker.png',\r\n    iconSize: [48, 48],\r\n});\r\n\r\nexport default function MapScreen() {\r\n    const [mapRef, setMapRef] = useState(null);\r\n    const [zoomLevel, setZoomLevel] = useState(4);\r\n    const [showDistricts, setShowDistricts] = useState(true);\r\n    const [showPrecincts, setShowPrecincts] = useState(true);\r\n    const [showNp, setShowNp] = useState(false);\r\n    const [showCommentTab, setShowCommentTab] = useState(false);\r\n\r\n    const [selectedState, setSelectedState] = useState(null);\r\n    const [selectedCd, setSelectedCd] = useState(null);\r\n    const [selectedPrecinct, setSelectedPrecinct] = useState(null);\r\n    const [selectedElection, setSelectedElection] = useState(Constants.ELECTIONS[0]);\r\n    const [selectedHistory, setSelectedHistory] = useState(null);\r\n\r\n    const [stateBorders, setStateBorders] = useState(null);\r\n    const stateLayerRefs = useRef([React.createRef(), React.createRef(), React.createRef()]);\r\n    const [cdBorders, setCdBorders] = useState(null);\r\n    const [precinctBorders, setPrecinctBorders] = useState(null);\r\n    const [precinctsRef, setPrecinctsRef] = useState(null);\r\n    const [npBorders, setNpBorders] = useState(null);\r\n\r\n    const [npMarkers] = useState([]);\r\n    const [ghostMarkers, setGhostMarkers] = useState([]);\r\n\r\n    const [history, setHistory] = useState([[], [], [], [], [], []]);\r\n    const [errors, setErrors] = useState([[], [], [], [], [], []]);\r\n\r\n    const [delayHandler, setDelayHandler] = useState(null)\r\n    const [addingNeighbor, setAddingNeighbor] = useState(false)\r\n    const [removingNeighbor, setRemovingNeighbor] = useState(false)\r\n    const [combiningPrecinct, setCombiningPrecinct] = useState(false)\r\n    const [rerender, setRerender] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const [drawController, setDrawController] = useState(null);\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            setStateBorders(await borderJsonRequester.getStateBorders());\r\n            setCdBorders(await borderJsonRequester.getCdBorders());\r\n            const npBorders = await borderJsonRequester.getNpBorders();\r\n            setNpBorders(npBorders);\r\n            npBorders.features.forEach(feature => {\r\n                const center = Turf.centroid(\r\n                    Turf.feature(feature.geometry)\r\n                );\r\n                center.geometry.coordinates = center.geometry.coordinates.reverse();\r\n                center.properties.name = feature.properties.UNIT_NAME;\r\n                npMarkers.push(center);\r\n            })\r\n        }\r\n        )();\r\n    }, [npMarkers]);\r\n\r\n    function calculateFeatureCenter(feature) {\r\n        return Turf.centroid(\r\n            Turf.feature(feature.geometry)\r\n        );\r\n    }\r\n\r\n    function handleStateChangeDropdown(stateName) {\r\n        handleStateChange(stateBorders[Constants.STATES.indexOf(stateName)], null);\r\n    }\r\n\r\n    async function handleStateChange(state, layer) {\r\n        if (selectedState && state.name === selectedState.name)\r\n            return;\r\n        if (!layer)\r\n            mapRef.leafletElement.fitBounds(stateLayerRefs.current[Constants.STATES.indexOf(state.name)].current.leafletElement.getBounds());\r\n        else\r\n            mapRef.leafletElement.fitBounds(layer.getBounds());\r\n        setSelectedState(null);\r\n        setSelectedState(state);\r\n        setSelectedCd(null);\r\n        setSelectedPrecinct(null);\r\n        setPrecinctBorders(null);\r\n        setHistory([[], [], [], [], [], []]);\r\n        setErrors([[], [], [], [], [], []]);\r\n    }\r\n\r\n    function handlePrecinctChange(layer) {\r\n        setSelectedPrecinct(null);\r\n        setSelectedPrecinct(layer.feature);\r\n    }\r\n\r\n    function handlePrecinctLayerOnClick(e) {\r\n        if (addingNeighbor) {\r\n            if (precinctRequester.updateNeighbor(selectedPrecinct.id, e.layer.feature.id, true)){\r\n                selectedPrecinct.neighbors.push(e.layer.feature.id);\r\n                e.layer.feature.neighbors.push(selectedPrecinct.id);\r\n                setAddingNeighbor(false);\r\n                handleAddHistory({ description: `Added ${e.layer.feature.id} to ${selectedPrecinct.id}'s neighbor` }, selectedPrecinct);\r\n                handleAddHistory({ description: `Added ${selectedPrecinct.id} to ${e.layer.feature.id}'s neighbor` }, e.layer.feature);\r\n                message.success('Successfully added neighbor.');\r\n            }\r\n        }\r\n        else if (removingNeighbor) {\r\n            for (var i = 0; i < selectedPrecinct.neighbors.length; i++) { \r\n                if (selectedPrecinct.neighbors[i] === e.layer.feature.id)\r\n                    selectedPrecinct.neighbors.splice(i, 1); \r\n            }\r\n            for (var j = 0; j < e.layer.feature.neighbors.length; j++) { \r\n               if (e.layer.feature.neighbors[j] === selectedPrecinct.id)\r\n                    e.layer.feature.neighbors.splice(j, 1); \r\n            }\r\n            if (precinctRequester.updateNeighbor(selectedPrecinct.id, e.layer.feature.id, false)){\r\n                setRemovingNeighbor(false);\r\n                handleAddHistory({ description: `Removed ${e.layer.feature.id} from ${selectedPrecinct.id}'s neighbor` }, selectedPrecinct);\r\n                handleAddHistory({ description: `Removed ${selectedPrecinct.id} from ${e.layer.feature.id}'s neighbor` }, e.layer.feature);\r\n                message.success('Successfully removed neighbor.');\r\n            }\r\n        }\r\n        else if (combiningPrecinct) {\r\n            if (!selectedPrecinct.properties.neighbors.includes(e.layer.feature.id)) {\r\n                message.error('Please select a neighbor precinct to combine.');\r\n                return;\r\n            }\r\n            const clickedPrecinct = e.layer.feature;\r\n            const newFeature = Turf.union(\r\n                Turf.feature(selectedPrecinct.geometry),\r\n                Turf.feature(clickedPrecinct.geometry)\r\n            );\r\n            newFeature.properties = {\r\n                NAME10: selectedPrecinct.id,\r\n                CONGRESSIO: selectedPrecinct.properties.CONGRESSIO,\r\n                neighbors: selectedPrecinct.properties.neighbors\r\n                    .concat(clickedPrecinct.properties.neighbors)\r\n                    .filter(item => {\r\n                        return item !== selectedPrecinct.id\r\n                            && item !== clickedPrecinct.id;\r\n                    }),\r\n                comments: selectedPrecinct.properties.comments.concat(clickedPrecinct.properties.comments),\r\n                demographic: selectedPrecinct.properties.demographic.map((item, index) => {\r\n                    return item + clickedPrecinct.properties.demographic[index]\r\n                }),\r\n                election: selectedPrecinct.properties.election.map((item, index) => {\r\n                    return item + clickedPrecinct.properties.election[index];\r\n                }),\r\n                isGhost: false\r\n            };\r\n            precinctBorders.features = precinctBorders.features.filter(item => {\r\n                return item.id !== selectedPrecinct.id\r\n                    && item.id !== clickedPrecinct.id;\r\n            });\r\n            precinctBorders.features.push(newFeature);\r\n            precinctsRef.leafletElement.clearLayers();\r\n            precinctsRef.leafletElement.addData(precinctBorders);\r\n            setSelectedPrecinct(null);\r\n            setSelectedPrecinct(newFeature);\r\n            handleAddHistory(`Combined precincts ${selectedPrecinct.id} with ${clickedPrecinct.id}`);\r\n            message.success('Successfully combined precincts.');\r\n            setCombiningPrecinct(false);\r\n        }\r\n        else if (selectedPrecinct && selectedPrecinct.id === e.layer.feature.id) {\r\n            setSelectedPrecinct(null);\r\n        }\r\n        else {\r\n            message.success(\"went to else\")\r\n            handlePrecinctChange(e.layer);\r\n        }\r\n    }\r\n\r\n    function handlePrecinctLayerMouseOver(e) {\r\n        if (addingNeighbor || combiningPrecinct || drawController) {\r\n            return;\r\n        }\r\n        setDelayHandler(setTimeout(() => {\r\n            handlePrecinctChange(e.layer);\r\n        }, 500))\r\n    }\r\n\r\n    function handleZoomChange() {\r\n        setZoomLevel(mapRef.viewport.zoom);\r\n    }\r\n\r\n    function handleShowPrecincts(e) {\r\n        setShowPrecincts(e.target.checked);\r\n    }\r\n\r\n    function handleShowDistricts(e) {\r\n        setShowDistricts(e.target.checked);\r\n    }\r\n\r\n    function handleShowNp(e) {\r\n        setShowNp(e.target.checked);\r\n    }\r\n\r\n    function handleCombinePrecinct() {\r\n        setCombiningPrecinct(true);\r\n        message.info('Please click on a neighbor precinct to combine.');\r\n    }\r\n\r\n    function handleConfirmGhostPrecinct() {\r\n        selectedPrecinct.name = selectedPrecinct.name.substring(selectedPrecinct.name.indexOf(\" \") + 1);\r\n        if (precinctRequester.updateGhostPrecinct(selectedPrecinct.id)) {\r\n            setRerender(!rerender);\r\n            handleAddHistory({ description: `Confirmed precinct ${selectedPrecinct.id} is a Ghost Precinct.` }, selectedPrecinct);\r\n            message.success('Action Completed');\r\n        }\r\n        else {\r\n            message.error('Action Failed');\r\n        }\r\n    }\r\n\r\n\r\n    function handleEditPrecinctLayer() {\r\n        const featureGroup = L.featureGroup([\r\n            new L.polygon(selectedPrecinct.geometry.coordinates[0].map(positions => [positions[1], positions[0]]))\r\n        ]);\r\n        mapRef.leafletElement.addLayer(featureGroup);\r\n        const drawController = new L.EditToolbar.Edit(mapRef.leafletElement, {\r\n            featureGroup: featureGroup\r\n        });\r\n        setDrawController(drawController);\r\n\r\n        mapRef.leafletElement.removeEventListener('draw:edited');\r\n        mapRef.leafletElement.addEventListener('draw:edited', function (e) {\r\n            const layersKey = Object.keys(e.layers._layers);\r\n            if (layersKey.length === 0)\r\n                return;\r\n            const layer = e.layers._layers[layersKey[0]];\r\n            const geoJson = {\r\n                type: \"Polygon\",\r\n                coordinates: [layer._latlngs[0].map(item => [item.lng, item.lat])]\r\n            }\r\n            const kinks = Turf.kinks(geoJson);\r\n            if (kinks.features.length) {\r\n                message.error(\"Self-Intersection Detected, Please Do It Again!\")\r\n                return\r\n            }\r\n            precinctRequester.updateBoundary(selectedPrecinct.id, JSON.stringify(geoJson));\r\n            selectedPrecinct.geometry = geoJson;\r\n            precinctsRef.leafletElement.clearLayers();\r\n            precinctsRef.leafletElement.addData(precinctBorders);\r\n            message.success(`Successfully edited ${selectedPrecinct.name}'s boundary.`);\r\n            handleAddHistory({ description: `Edited ${selectedPrecinct.name}'s boundary.` }, selectedPrecinct);\r\n        });\r\n\r\n        mapRef.leafletElement.removeEventListener('draw:editstop');\r\n        mapRef.leafletElement.addEventListener('draw:editstop', function (e) {\r\n            mapRef.leafletElement.removeLayer(featureGroup);\r\n        });\r\n        drawController.enable();\r\n    }\r\n\r\n    function handleDrawSave() {\r\n        if (drawController instanceof L.Draw.Polygon)\r\n            drawController.completeShape();\r\n        else\r\n            drawController.save();\r\n        handleClickedCancel();\r\n    }\r\n\r\n    function handleClickedCancel() {\r\n        if (addingNeighbor) {\r\n            setAddingNeighbor(false);\r\n            message.info('Cancelled adding neighbor.');\r\n        }\r\n        else if (combiningPrecinct) {\r\n            setCombiningPrecinct(false);\r\n            message.info('Cancelled combining precincts.');\r\n        }\r\n        else {\r\n            drawController.disable();\r\n            setDrawController(null);\r\n        }\r\n    }\r\n\r\n    function handleDrawUndo() {\r\n        if (drawController instanceof L.Draw.Polygon)\r\n            drawController.deleteLastVertex();\r\n        else\r\n            drawController.revertLayers();\r\n    }\r\n\r\n    function handleAddNeighbor() {\r\n        setAddingNeighbor(true);\r\n        message.info('Please click on another precinct to add.');\r\n    }\r\n\r\n    function handleRemoveNeighbor() {\r\n        setRemovingNeighbor(true);\r\n        message.info('Please click on another precinct to remove.');\r\n    }\r\n\r\n    async function handleAddHistory(newHistory, precinct, layer = null) {\r\n        newHistory.timestamp = moment();\r\n        if (await historyRequester.postHistory(newHistory, precinct.id)) {\r\n            if (newHistory.category)\r\n                history[Constants.ERROR_ENUM.indexOf(newHistory.category)].push([newHistory, layer]);\r\n            newHistory.precinct = precinct;\r\n            precinct.histories.push(newHistory);\r\n        }\r\n        else {\r\n            message.error('Failed to post history.');\r\n        }\r\n        // setHistory([newLog, ...history]);\r\n    }\r\n\r\n    function handleZoomInPrecinct(feature, layer) {\r\n        setSelectedPrecinct(feature);\r\n        mapRef.leafletElement.fitBounds(layer.getBounds());\r\n    }\r\n\r\n    function handleResolvedError(error, index, layer) {\r\n        const res = errorRequester.ResolveError(error.id);\r\n        if (res) {\r\n            errors[index] = errors[index].filter((item) => {\r\n                return error.id !== item[0].id;\r\n            });\r\n            setRerender(!rerender);\r\n            const description = \"Resolved error \" + Constants.ERROR_HEADER[Constants.ERROR_ENUM.indexOf(error.category)]\r\n                + \". Error description: \" + error.description;\r\n            handleAddHistory({ description, category: error.category }, error.precinct, layer);\r\n            message.success('Successfully resolved the error.');\r\n        }\r\n        else {\r\n            message.error('Failed to resolve.');\r\n        }\r\n    }\r\n\r\n    function handleOpenCommentTab(history) {\r\n        setShowCommentTab(true);\r\n        setSelectedHistory(history);\r\n    }\r\n\r\n    function handleCloseCommentTab() {\r\n        setShowCommentTab(false);\r\n        setSelectedHistory(null);\r\n    }\r\n\r\n    function handleAddComment(comment, timestamp) {\r\n\r\n    }\r\n\r\n    function onEachStateFeature(state, layer) {\r\n        state.elections = JSON.parse(JSON.stringify(Constants.FAKE_ELECTION));\r\n        layer.on({\r\n            click: async () => {\r\n                handleStateChange(state, layer);\r\n            },\r\n            mouseover: () => {\r\n                layer.setStyle({\r\n                    weight: 3\r\n                });\r\n            },\r\n            mouseout: () => {\r\n                layer.setStyle({\r\n                    weight: 1\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function onEachCdFeature(district, layer) {\r\n        district.elections = JSON.parse(JSON.stringify(Constants.FAKE_ELECTION));\r\n        layer.on({\r\n            click: async () => {\r\n                setLoading(true);\r\n                setSelectedCd(null);\r\n                setPrecinctBorders(null);\r\n                setSelectedPrecinct(null);\r\n                setHistory([[], [], [], [], [], []]);\r\n                setErrors([[], [], [], [], [], []]);\r\n                await borderJsonRequester.getPrecinctBorder(district.name).then(res => {\r\n                    setPrecinctBorders(res);\r\n                });\r\n                setSelectedCd(district);\r\n                setLoading(false);\r\n            },\r\n            mouseover: () => {\r\n                layer.setStyle({\r\n                    weight: 3\r\n                });\r\n            },\r\n            mouseout: () => {\r\n                layer.setStyle({\r\n                    weight: 1\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function onEachPrecinctFeature(precinct, layer) {\r\n        precinct.elections = JSON.parse(JSON.stringify(Constants.FAKE_ELECTION));\r\n\r\n        precinct.errors.forEach((item, index) => {\r\n            item.precinct = precinct;\r\n            if (item.category)\r\n                errors[Constants.ERROR_ENUM.indexOf(item.category)].push([item, layer]);\r\n        });\r\n\r\n        precinct.histories.forEach((item, index) => {\r\n            item.precinct = precinct;\r\n            if (item.category)\r\n                history[Constants.ERROR_ENUM.indexOf(item.category)].push([item, layer]);\r\n        });\r\n    }\r\n\r\n    return (\r\n        <Layout>\r\n            <StateContext.Provider value={selectedState}>\r\n                <DistrictContext.Provider value={selectedCd}>\r\n                    <HistoryContext.Provider value={[history, handleAddHistory]}>\r\n                        <RerenderContext.Provider value={[rerender, setRerender]}>\r\n                            <LeftPanel\r\n                                errors={errors}\r\n                                history={history}\r\n                                handleZoomInPrecinct={handleZoomInPrecinct}\r\n                                handleResolvedError={handleResolvedError}\r\n                                handleAddComment={handleAddComment}\r\n                                handleOpenCommentTab={handleOpenCommentTab}\r\n                            />\r\n                            <Layout>\r\n                                <Layout.Header>\r\n                                    <HeaderPanel\r\n                                        selectedPrecinct={selectedPrecinct}\r\n                                        zoomLevel={zoomLevel}\r\n                                        handleStateChangeDropdown={handleStateChangeDropdown}\r\n                                        combiningPrecinct={combiningPrecinct}\r\n                                        handleCombinePrecinct={handleCombinePrecinct}\r\n                                        addingNeighbor={addingNeighbor}\r\n                                        removingNeighbor={removingNeighbor}\r\n                                        handleAddNeighbor={handleAddNeighbor}\r\n                                        handleRemoveNeighbor={handleRemoveNeighbor}\r\n                                        handleConfirmGhostPrecinct={handleConfirmGhostPrecinct}\r\n                                        handleEditPrecinctLayer={handleEditPrecinctLayer}\r\n                                        drawController={drawController}\r\n                                        handleClickedCancel={handleClickedCancel}\r\n                                        handleDrawSave={handleDrawSave}\r\n                                        handleDrawUndo={handleDrawUndo}\r\n                                    />\r\n                                </Layout.Header>\r\n                                <Spin spinning={loading} size=\"large\">\r\n                                    <Layout.Content>\r\n                                        <Map\r\n                                            ref={(ref) => { setMapRef(ref); }}\r\n                                            center={Constants.MAP_CENTER}\r\n                                            zoom={4}\r\n                                            zoomControl={false}\r\n                                            animate={true}\r\n                                            onZoomEnd={handleZoomChange}\r\n                                            preferCanvas={true}\r\n                                        >\r\n                                            <TileLayer\r\n                                                attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n                                                url=\"https://api.tiles.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaGFubGl1IiwiYSI6ImNrNnk3YTZpMzBlcjczZW15cmU1Mm5hMWkifQ.dW0oDKWDng4w-osIkRvLsQ\"\r\n                                            />\r\n                                            <ZoomControl position='bottomright' />\r\n                                            <Control position=\"bottomleft\" >\r\n                                                <Card>\r\n                                                    <Checkbox\r\n                                                        defaultChecked={true}\r\n                                                        onChange={handleShowDistricts}\r\n                                                        disabled={zoomLevel < Constants.DP_ZOOM_LEVEL || !selectedState}\r\n                                                    >\r\n                                                        Show Districts\r\n                                    </Checkbox>\r\n                                                    <br />\r\n                                                    <Checkbox\r\n                                                        defaultChecked={true}\r\n                                                        onChange={handleShowPrecincts}\r\n                                                        disabled={zoomLevel < Constants.DP_ZOOM_LEVEL || !selectedCd}\r\n                                                    >\r\n                                                        Show Precincts\r\n                                    </Checkbox>\r\n                                                    <br />\r\n                                                    <Checkbox onChange={handleShowNp}>\r\n                                                        Show National Parks &nbsp;\r\n                                        <img src=\"images/NpIcon.png\" alt=\"National Park Icon\" className=\"icon\" />\r\n                                                    </Checkbox>\r\n                                                </Card>\r\n                                            </Control>\r\n\r\n                                            {stateBorders &&\r\n                                                stateBorders.map((stateBorder, index) => {\r\n                                                    if (selectedState\r\n                                                        && stateBorder.name === selectedState.name\r\n                                                        && zoomLevel >= Constants.DP_ZOOM_LEVEL\r\n                                                        && (showDistricts || (showPrecincts && selectedCd))\r\n                                                    ) {\r\n                                                        return (\r\n                                                            <React.Fragment key={\"F\" + index}>\r\n                                                                {showDistricts && <GeoJSON\r\n                                                                    key={\"CD\" + index}\r\n                                                                    data={cdBorders[Constants.STATES.indexOf(selectedState.name)]}\r\n                                                                    style={layerStyler.geoJSONCdStyle}\r\n                                                                    onEachFeature={onEachCdFeature}\r\n                                                                />\r\n                                                                }\r\n                                                                {(showPrecincts && precinctBorders) && <GeoJSON\r\n                                                                    key={\"P\" + index}\r\n                                                                    ref={(ref) => { setPrecinctsRef(ref); }}\r\n                                                                    data={precinctBorders}\r\n                                                                    style={(feature) => layerStyler.geoJSONPrecinctStyle(feature, selectedPrecinct)}\r\n                                                                    onEachFeature={onEachPrecinctFeature}\r\n                                                                    onClick={handlePrecinctLayerOnClick}\r\n                                                                    onMouseOver={handlePrecinctLayerMouseOver}\r\n                                                                    onMouseOut={() => clearTimeout(delayHandler)}\r\n                                                                />\r\n                                                                }\r\n                                                            </React.Fragment>\r\n                                                        );\r\n                                                    }\r\n                                                    else {\r\n                                                        return (\r\n                                                            <GeoJSON\r\n                                                                key={\"S\" + index}\r\n                                                                ref={stateLayerRefs.current[index]}\r\n                                                                data={stateBorder}\r\n                                                                style={layerStyler.geoJSONStateStyle}\r\n                                                                onEachFeature={onEachStateFeature}\r\n                                                            />\r\n                                                        );\r\n                                                    }\r\n                                                })\r\n                                            }\r\n                                            {(npBorders && showNp) && (\r\n                                                <React.Fragment>\r\n                                                    <GeoJSON\r\n                                                        data={npBorders}\r\n                                                        style={(feature) => layerStyler.geoJSONNpStyle(feature)}\r\n                                                    />\r\n                                    )}\r\n                                                    {npMarkers.map((feature, index) =>\r\n                                                        <Marker\r\n                                                            key={`marker-${index}`}\r\n                                                            position={feature.geometry.coordinates}\r\n                                                            icon={NpMarker}\r\n                                                        >\r\n                                                            <Popup>\r\n                                                                <span>Name: {feature.properties.name}</span>\r\n                                                            </Popup>\r\n                                                        </Marker>\r\n                                                    )}\r\n                                                </React.Fragment>\r\n                                            )}\r\n                                        </Map>\r\n                                    </Layout.Content>\r\n                                </Spin>\r\n                            </Layout>\r\n                            <RightPanel selectedPrecinct={selectedPrecinct} selectedCd={selectedCd} />\r\n                            <CommentTab\r\n                                showCommentTab={showCommentTab}\r\n                                handleCloseCommentTab={handleCloseCommentTab}\r\n                                selectedHistory={selectedHistory}\r\n                            />\r\n                        </RerenderContext.Provider>\r\n                    </HistoryContext.Provider>\r\n                </DistrictContext.Provider>\r\n            </StateContext.Provider>\r\n        </Layout>\r\n    );\r\n}"]},"metadata":{},"sourceType":"module"}